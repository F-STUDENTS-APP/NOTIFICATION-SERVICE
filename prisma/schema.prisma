generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Notification {
  id                String            @id @default(uuid())
  userId            String            // Recipient User ID
  type              String            // e.g., VIOLATION_CREATED, ACHIEVEMENT_APPROVED
  title             String
  message           String            @db.Text
  category          NotificationCategory @default(GENERAL)
  
  // Recipient details (optional if userId is used to resolve)
  recipientEmail    String?
  recipientName     String?
  
  // Data for redirect or context
  data              Json?             // e.g., { violationId: 'uuid' }
  
  // Channels attempted
  channels          Json?             // Array of strings: ['INTERNAL', 'EMAIL', 'WA']
  
  // Status
  status            NotificationStatus @default(PENDING)
  failureReason     String?           @db.Text
  
  // User interaction
  readAt            DateTime?
  
  // Meta
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
  
  @@index([userId])
  @@index([status])
  @@index([createdAt])
  @@map("notifications")
}

model NotificationTemplate {
  id            String    @id @default(uuid())
  code          String    @unique   // e.g., VIOLATION_WALI_APPROVAL
  name          String
  subject       String?             // For Email
  body          String    @db.Text  // For all, support placeholders {{studentName}}
  channels      Json?               // Preferred channels
  isActive      Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  @@map("notification_templates")
}

enum NotificationCategory {
  GENERAL
  VIOLATION
  ACHIEVEMENT
  ACADEMIC
  SYSTEM
}

enum NotificationStatus {
  PENDING
  SENT
  FAILED
}
